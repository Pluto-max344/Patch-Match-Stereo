
# **PatchMatch Stereo Report**

## **1. 研究背景与问题**

传统的局部立体匹配方法通常假设**支持窗口（support window）内的像素具有恒定视差**，即窗口对应一个**正面平行表面（fronto-parallel surface）**。这一假设在实际场景中常不成立，导致：

- 无法准确重建**倾斜表面**；
- 在**非正面平行结构**上产生阶梯状伪影；
- **亚像素精度**难以实现。

## **2. 核心思想**

提出一种**基于倾斜支持窗口的局部立体匹配方法**，为**每个像素估计一个独立的3D平面**，将支持窗口投影到该平面上进行匹配，从而克服传统方法的“正面平行偏差”。

## **3. 相似研究**

### 3.1《PatchMatch Stereo - Stereo Matching with Slanted Support Windows》

#### 3.1.1 平面模型与匹配代价

- 每个像素 \( p \) 关联一个3D平面 \( f_p \)，参数为 \( (a_f, b_f, c_f) \)。
- 平面方程：  
  \[
  d_p = a_f p_x + b_f p_y + c_f
  \]
- 匹配代价函数为加权聚合代价：
  \[
  m(p, f) = \sum_{q \in W_p} w(p, q) \cdot \rho(q, q')
  \]
  - \( W_p \)：支持窗口（可扩展为3D时空窗口）
  - \( w(p, q) \)：基于颜色相似性的自适应权重（如指数衰减函数）
  - \( \rho(q, q') \)：像素差异度量（结合颜色与梯度，具有截断鲁棒性）

#### 3.1.2 基于 PatchMatch 的平面推断

由于标签空间（所有可能平面）无限大，采用 **PatchMatch 随机搜索与传播策略** 求解。

#### 步骤流程

1. **随机初始化**  
   - 为每个像素随机生成一个平面（通过随机采样视差与法向量）。

2. **迭代优化（多次迭代）**  
   - **空间传播**：检查相邻像素的平面，若代价更低则采纳。
   - **视图传播**：利用左右视图一致性，从匹配点传播平面。
   - **时间传播**（针对视频）：跨帧传播平面，增强时序一致性。
   - **平面细化**：随机扰动当前平面参数，逐步缩小扰动范围，寻找更优解。

3. **传播顺序**  
   - 偶数次迭代：从上到下、从左到右  
   - 奇数次迭代：反向进行，促进信息扩散。

#### 3.1.3 后处理

- **左右一致性检查**：标记遮挡与误匹配像素。
- **遮挡填充**：从最近有效像素的平面外推视差，并使用**加权中值滤波**平滑。

#### 3.1.4 扩展为全局方法的数据项

- 构建**代价体**，每一层对应一个整数值视差，使用 PatchMatch 计算该视差范围内的最优平面匹配代价。
- 将上述数据项嵌入全局能量最小化框架（如图割、α-expansion），支持显式遮挡处理与无纹理区域重建。

#### 优缺点

##### 一、优点

- **克服正面平行表面的局限**：通过为每个像素估计独立的三维平面，**重建任意朝向的倾斜表面**。
- **将无限标签空间搜索问题转化为高效随机优化**：创新性地将 **PatchMatch** 算法引入立体匹配，解决了平面参数空间无限大无法穷举搜索的问题。
- **多维度传播机制增强一致性**：空间、视图、时间（视频）三重传播策略，有效利用了场景的**空间连续性、立体一致性和时序连贯性**，提升了平面估计的鲁棒性。
- **亚像素精度内生于匹配过程**：平面模型支持**连续视差**，无需后处理插值即可实现亚像素级重建，精度高于传统离散化方法。
- **内存效率高**：算法仅需存储每个像素的平面参数和聚合代价，无需构建完整的离散代价体，适合处理**高分辨率图像和视频**。

##### 二、局限性

- **平面假设对非平面曲面是近似**：虽然论文指出在光滑曲面上近似效果良好，但对于**高度非线性或尖锐变化的曲面**（如复杂雕像、植被），多个小平面拼接可能产生偏差，无法像参数化曲面或深度学习那样表达更复杂的几何。
- **随机初始化的不确定性**：算法性能依赖于随机初始化能否在局部区域内至少产生一个“接近正确”的平面猜测。在**纹理非常微弱或重复**的区域，可能失败。
- **传播机制可能陷入局部最优**：尽管有反向迭代，但在**大范围平滑区域或弱纹理区域**，错误的平面估计可能通过传播而持续，难以纠正。
- 遮挡检测和填充作为**后处理**步骤，**并非在能量最小化框架内统一求解**。填充策略（选择较小视差、中值滤波）虽有道理但相对启发式，可能在复杂遮挡边界产生瑕疵。
- **对全局上下文利用有限**：作为局部方法，尽管代价聚合使用了自适应权重，但对**场景级的语义信息、几何先验**利用不足。在面对大范围无纹理区域（如白墙）时，局部方法可能完全失效，需依赖其“为全局方法提供数据项”的模式。

#### 三、潜在改进方向
